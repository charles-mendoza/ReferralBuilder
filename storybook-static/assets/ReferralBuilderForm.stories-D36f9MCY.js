import{j as i}from"./jsx-runtime-z8MfsBtr.js";import{R as k,m as G}from"./mock-ksYNSFqH.js";import{B as w}from"./Button-YtFrUkwT.js";import{F as H}from"./FormHeader-Dc9-TS-z.js";import{I as A}from"./Input-DiOAHkWd.js";import{r as j}from"./index-C2Vpk4u-.js";import"./index-C9rmetsa.js";import"./iframe-DzajngJc.js";import"./clsx-B-dksMZM.js";function P(){var p;const[b,F]=j.useState({}),[l,m]=j.useState({}),[v,R]=j.useState({}),g=j.useRef({}),x=(r,e)=>{var y;if(!r||!((y=v[r])!=null&&y.validation))return null;const{pattern:n,required:a,maxLength:c,minLength:f,min:d,max:h}=v[r];return a===!0&&(!e&&typeof e!="boolean"||Array.isArray(e)&&!e.length)?"Required field":n&&(typeof e=="string"&&!e.toLowerCase().match(n)&&e!==""||e===void 0&&a===!0)?"Invalid value":c&&typeof e=="string"&&e.length>c?"maxLength":f&&(typeof e=="string"&&e.length<f||e===void 0)?"minLength":d&&e<d?"min":h&&e>h?"max":null},V=()=>{Object.keys(l).forEach(e=>{const n=x(e,l[e].value);m(a=>({...a,[e]:{...a[e],error:n}}))})},E=async r=>{const{name:e,value:n,type:a,checked:c,files:f}=r.target||r,d=x(e,n);m(h=>({...h,[e]:{...h[e],value:a==="checkbox"?c:n,files:a==="file"?f:void 0,error:d}}))},S=r=>{const{name:e,value:n}=r.target,a=x(e,n);m(c=>({...c,[e]:{...c[e],value:n,error:a}}))},B=(r,e)=>{var O;const{required:n,type:a,pattern:c,maxLength:f,minLength:d,defaultValue:h,min:y,max:L}=e||{},$=!!(n||c||f||d||y||L),C=((O=l[r])==null?void 0:O.value)||"";return g.current&&(g.current={...g.current,[r]:{value:h,error:void 0,required:n||!1,pattern:c,maxLength:f,minLength:d,min:y,max:L,validation:$}}),{type:a,name:r,onChange:E,onBlur:S,value:C}},u=()=>{m(b)};j.useEffect(()=>{const r=g.current;R({...r});const n=Object.keys(r).reduce((a,c)=>{const f=r[c].value,d={value:f};return a[c]={value:r[c].validation?d===void 0?f:(d==null?void 0:d.value)||"":"",error:void 0},a},{});F(n),m(n)},[g]);let t=!1;const s=Object.values(l);s.length&&(t=s.every(r=>r.error===null||r.error===void 0));const o={};return(p=Object.keys(l))==null||p.forEach(r=>{var e;o[r]=(e=l==null?void 0:l[r])==null?void 0:e.error}),{validateAll:V,formData:l,error:o,isValid:t,reset:u,register:B}}const U="_main_dgvgl_1",W="_container_dgvgl_8",z="_group_dgvgl_14",J="_fields_dgvgl_17",_={main:U,container:W,group:z,fields:J},q=({title:b,data:F,onCreate:l})=>{const{register:m,formData:v,error:R,isValid:g,validateAll:x,reset:V}=P(),E=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i,S=async u=>{if(u.preventDefault(),x(),g)try{let t="";if(v.avatar.files){const o=v.avatar.files[0];t=await k.uploadAvatar(o)}const s=Object.fromEntries(Object.entries(v).map(([o,p])=>[o,p.value]));await k.createReferral({...s,avatar:t}),V(),l&&l()}catch(t){t.details?alert(t.details):t.message&&alert(t.message),console.error(t)}},B=(u,t,s,o,p,r)=>{switch(u){case"text":return i.jsx(A,{name:t,placeholder:s,required:o,error:p,...m(t,{type:u,required:o,maxLength:r})});case"email":return i.jsx(A,{name:t,placeholder:s,required:o,error:p,...m(t,{type:u,required:o,maxLength:r,pattern:E})});case"file":return i.jsxs(i.Fragment,{children:[i.jsx("input",{id:"fileInput",style:{display:"none"},...m(t,{type:u,required:o})}),i.jsx(w,{type:"button",variant:"secondary",error:p,onClick:()=>{var e;return(e=document.getElementById("fileInput"))==null?void 0:e.click()},children:s})]});case"submit":return i.jsx(w,{type:"submit",variant:"primary",children:s})}};return i.jsx("div",{className:_.main,children:i.jsxs("div",{className:_.container,children:[i.jsx("h1",{children:b}),i.jsx("form",{onSubmit:S,children:F.map((u,t)=>i.jsxs("div",{className:_.group,children:[u.title&&i.jsx(H,{children:u.title}),i.jsx("div",{className:_.fields,children:u.fields.map((s,o)=>i.jsx("div",{children:B(s.type,s.name,s.label,s.required,!!R[s.name],100)},`form-fields-${t}${o}`))})]},`form-group-${t}`))})]})})};q.__docgenInfo={description:"",methods:[],displayName:"ReferralBuilderForm",props:{title:{required:!0,tsType:{name:"string"},description:""},data:{required:!0,tsType:{name:"Array",elements:[{name:"IFormGroup"}],raw:"IFormGroup[]"},description:""},onCreate:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const ne={title:"Widgets/ReferralBuilderForm",component:q,tags:["autodocs"],argTypes:{}},I={args:{...G.formData}};var D,N,T;I.parameters={...I.parameters,docs:{...(D=I.parameters)==null?void 0:D.docs,source:{originalSource:`{
  args: {
    ...mock.formData
  }
}`,...(T=(N=I.parameters)==null?void 0:N.docs)==null?void 0:T.source}}};const se=["Default"];export{I as Default,se as __namedExportsOrder,ne as default};
